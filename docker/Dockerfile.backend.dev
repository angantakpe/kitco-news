FROM node:18-alpine

WORKDIR /usr/src/node-app

# Add nodemon for development
RUN npm install -g nodemon

COPY package*.json yarn.lock ./

RUN yarn install --pure-lockfile

COPY . .

EXPOSE 3001 8080 8081

# Use development mode by default
ENV NODE_ENV=development

# Use nodemon for hot reloading in development
CMD ["nodemon", "--watch", "src", "--exec", "yarn", "dev", "-L"]